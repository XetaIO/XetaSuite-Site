---
title: Auth API
description: Documentation de l'API d'authentification XetaSuite.
---

import { Aside } from '@astrojs/starlight/components';

XetaSuite utilise **Laravel Sanctum** en mode stateful (cookies) pour l'authentification SPA.

## Endpoints d'authentification

### Obtenir le cookie CSRF

<Aside type="caution">
  Cet endpoint doit être appelé **avant** login et logout.
</Aside>

```http
GET /sanctum/csrf-cookie
```

**Réponse :** Cookie `XSRF-TOKEN` défini

---

### Login

```http
POST /api/v1/auth/login
```

**Headers :**
```
Content-Type: application/json
Accept: application/json
X-XSRF-TOKEN: {token from cookie}
```

**Body :**
```json
{
    "email": "user@example.com",
    "password": "password",
    "remember": true
}
```

**Réponse 200 :**
```json
{
    "two_factor": false
}
```

**Réponse 422 (Validation) :**
```json
{
    "message": "The provided credentials are incorrect.",
    "errors": {
        "email": ["The provided credentials are incorrect."]
    }
}
```

---

### Two-Factor Challenge

Si `two_factor: true` dans la réponse login :

```http
POST /api/v1/auth/two-factor-challenge
```

**Body :**
```json
{
    "code": "123456"
}
```

Ou avec un code de récupération :
```json
{
    "recovery_code": "abcd-efgh-ijkl"
}
```

---

### Logout

```http
POST /api/v1/auth/logout
```

**Réponse 204 :** No Content

---

### Utilisateur courant

```http
GET /api/v1/user
```

**Réponse 200 :**
```json
{
    "data": {
        "id": 1,
        "username": "jdupont",
        "first_name": "Jean",
        "last_name": "Dupont",
        "full_name": "Jean Dupont",
        "email": "jean.dupont@example.com",
        "locale": "fr",
        "current_site_id": 1,
        "roles": ["admin"],
        "permissions": [
            "material.viewAny",
            "material.view",
            "material.create",
            "..."
        ],
        "sites": [
            {
                "id": 1,
                "name": "Siège Paris",
                "is_headquarters": true
            },
            {
                "id": 2,
                "name": "Usine Lyon",
                "is_headquarters": false
            }
        ]
    }
}
```

---

### Changer de site

```http
PATCH /api/v1/user/site
```

**Body :**
```json
{
    "site_id": 2
}
```

**Réponse 200 :**
```json
{
    "data": {
        "id": 1,
        "current_site_id": 2,
        "roles": ["manager"],
        "permissions": ["...nouveau set de permissions..."],
        "..."
    }
}
```

---

### Changer la langue

```http
PATCH /api/v1/user/locale
```

**Body :**
```json
{
    "locale": "en"
}
```

---

### Forgot Password

```http
POST /api/v1/auth/forgot-password
```

**Body :**
```json
{
    "email": "user@example.com"
}
```

**Réponse 200 :**
```json
{
    "message": "We have emailed your password reset link!"
}
```

---

### Reset Password

```http
POST /api/v1/auth/reset-password
```

**Body :**
```json
{
    "token": "reset-token-from-email",
    "email": "user@example.com",
    "password": "NewSecurePass123!",
    "password_confirmation": "NewSecurePass123!"
}
```

## Codes d'erreur

| Code | Description |
|------|-------------|
| 401 | Non authentifié |
| 403 | Accès interdit (permission manquante) |
| 419 | Session expirée (CSRF token invalide) |
| 422 | Erreur de validation |
| 429 | Trop de requêtes (rate limiting) |

## Prochaines étapes

- [Endpoints principaux](/api/endpoints/) - Référence API complète
- [Authentification](/concepts/authentication/) - Comprendre le flow
