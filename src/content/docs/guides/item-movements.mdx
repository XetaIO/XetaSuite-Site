---
title: Mouvements de pièces
description: Guide pour gérer les entrées et sorties de stock dans XetaSuite.
---

import { Steps, Aside } from '@astrojs/starlight/components';

Les **ItemMovements** permettent de tracer toutes les entrées et sorties de stock.

## Types de mouvements

| Type | Description | Impact stock |
|------|-------------|--------------|
| `ENTRY` | Réception de marchandise | +quantité |
| `EXIT` | Sortie/utilisation | -quantité |

## Créer un mouvement d'entrée/sortie

<Steps>

1. **Accéder au module Pièces**

   Depuis le menu latéral, cliquez sur **Pièces**.

2. **Cliquer sur "Ajouter Entrée/Sortie" sur la pièce**

3. **Remplir le formulaire**

   | Champ | Obligatoire | Description |
   |-------|----------|-------------|
   | Quantité | ✅ | Nombre d'unités |
   | Prix unitaire | ❌ | Prix unitaire |
   | Fournisseur | ❌ | Entreprise source |
   | Numéro de facture | ❌ | Numéro de commande |
   | Date de facture | ❌ | Date de commande |
   | Date | ❌ | Date de l'entrée/sortie |
   | Notes | ❌ | Commentaires |

4. **Valider**

   Le stock est automatiquement mis à jour.

</Steps>

## API - Créer un mouvement

### Endpoint

```http
POST /api/v1/item-movements
```

### Payload - Entrée

```json
{
    "item_id": 1,
    "type": "ENTRY",
    "quantity": 50,
    "company_id": 3,
    "reference": "PO-2024-0042",
    "notes": "Réception commande annuelle"
}
```

### Payload - Sortie

```json
{
    "item_id": 1,
    "type": "EXIT",
    "quantity": 5,
    "maintenance_id": 12,
    "notes": "Utilisé pour maintenance préventive"
}
```

### Payload - Ajustement

```json
{
    "item_id": 1,
    "type": "ADJUSTMENT",
    "quantity": -3,
    "notes": "Correction de stock après inventaire"
}
```

## Calcul du stock

La `quantity` de la pièce est automatiquement recalculée :

```
stock_actuel = Σ entrées - Σ sorties + Σ ajustements
```

## Alertes de seuil d'avertissement minimum

Quand le stock passe sous le seuil d'avertissement minimum, une notification d'alerte est déclenchée :

```json
{
    "item_id": 1,
    "name": "Filtre à air XL",
    "quantity": 2,
    "number_warning_minimum": 5,
    "number_warning_enabled": true
}
```

## Alertes de seuil critique minimum

Quand le stock passe sous le seuil critique minimum, un email d'alerte et une notification sont déclenchés :

```json
{
    "item_id": 1,
    "name": "Filtre à air XL",
    "quantity": 2,
    "number_critical_minimum": 5,
    "number_critical_enabled": true
}
```

## Permissions requises

| Action | Permission |
|--------|------------|
| Voir la liste | `item-movement.viewAny` |
| Voir un mouvement | `item-movement.view` |
| Créer | `item-movement.create` |
| Modifier | `item-movement.update` |
| Supprimer | `item-movement.delete` |

## Historique des mouvements

Tous les mouvements sont journalisés avec :
- Date de création
- Utilisateur qui a créé le mouvement
- Quantité précédente et nouvelle

```http
GET /api/v1/items/{id}/movements
```
